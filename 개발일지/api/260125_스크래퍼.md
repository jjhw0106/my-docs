# 📅 26년 1월 25일 (스크래퍼 서버 작업 - 원티드 추가)

---

### ✅ 1. 원티드(Wanted) 스크래핑 기능 구현
**목표:** 잡코리아에 이어 원티드 플랫폼의 지원 내역을 자동으로 수집하는 기능을 추가한다. 원티드는 소셜 로그인 및 이메일 인증 등 복잡한 로그인 방식을 사용하므로 이에 대한 유연한 대응이 필요했다.

#### 1.1. 로그인 및 페이지 이동 전략 (핵심 트러블슈팅 🚀)
초기에는 `로그인 페이지 이동 -> 로그인 수행 -> 지원 현황 페이지 이동`의 순차적인 방식을 시도했으나, 다음과 같은 문제에 봉착했다.
*   **문제점**: `id.wanted.jobs`에서 로그인을 성공해도, `www.wanted.co.kr`로 이동 시 세션(쿠키)이 즉시 공유되지 않아 다시 로그인 페이지로 리다이렉트되거나, 엉뚱한 프로필 페이지(`profile/myinfo`)에 멈춰버리는 현상 발생.
*   **해결책 (역발상 전략)**: **"목표 페이지로 먼저 이동하라"**
    1.  스크래퍼가 로그인 여부를 따지지 않고 무조건 **지원 현황 페이지(`status/applications/applied`)**로 직행한다.
    2.  로그인이 안 되어 있다면 원티드 서버가 알아서 `before_url` 파라미터를 포함하여 로그인 페이지로 리다이렉트 시킨다.
    3.  사용자(또는 자동화 로직)가 로그인을 완료하면, 원티드가 다시 원래 목표였던 `before_url`(지원 현황 페이지)로 사용자를 복귀시킨다.
    *   이 방식을 통해 복잡한 리다이렉트 흐름을 직접 제어할 필요 없이, 자연스러운 페이지 이동을 구현해냈다.


#### 1.2. 데이터 파싱 및 페이지네이션
*   원티드의 지원 내역은 `ul > li` 구조로 되어 있으나 클래스명이 난독화되어 있어, 텍스트 패턴 매칭(`YYYY.MM.DD` 형식 감지)을 통해 회사명, 포지션, 날짜, 상태를 추출하는 로직을 구현했다.
*   `Next page` 버튼을 찾아 클릭하며 데이터가 더 이상 없을 때까지 전체 페이지를 순회하도록 구현했다.

---

### 💡 2. 아키텍처 및 관심사 분리 (Refactoring Review)
**스크래핑 서비스 아키텍처의 유연성** :  기존에 설계 잘해놨다고 생각들었다. (별도 코드 수정없이, 기존에 메소드로 빼놓았던 scrapeWanted() 메소드 하나만 구현을 완성함으로서, 서비스 확장 성공)

*   **확장에 열려있는 구조**: `ScraperService` 내의 `scrapePlatform` 메서드가 이미 플랫폼별 분기 처리를 위한 템플릿 역할을 하고 있었다.
    ```typescript
    // 기존 코드 (템플릿)
    async scrapePlatform(...) {
        // 공통: 브라우저 실행, 페이지 생성
        switch(platform) {
            case 'jobkorea': return this.scrapeJobKorea(...);
            case 'wanted': return this.scrapeWanted(...); // <- 이 메서드만 추가하면 끝!
        }
        // 공통: 데이터 저장, 브라우저 종료
    }
    ```
*   **프론트엔드 영향 최소화**: 백엔드에서 `scrapeWanted` 메서드 하나를 구현하는 것만으로, 프론트엔드의 별도 수정 없이(단순히 호출만 하면 됨) 기능이 즉시 동작했다. 이는 **비즈니스 로직이 백엔드에 잘 캡슐화**되어 있음을 의미한다.

---

### 📝 3. 주요 코드 변경 사항
*   `src/scraper/scraper.service.ts`:
    *   `scrapeWanted` 메서드 추가 (자동/수동 로그인, 페이지네이션, 데이터 파싱).
    *   로그인 감지 로직 개선 (URL 패턴 매칭).
    *   브라우저 종료 로직 활성화 (`finally` 블록).

---

### 🔜 Next Step
*   **auth-server**: JWT 기반 인증 고도화 및 MSA 간 토큰 검증 로직 구현.
*   **IP 보안**: MongoDB Atlas 접속을 위한 동적 IP 화이트리스팅 기능 추가 검토.
